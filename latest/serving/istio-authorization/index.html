
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Knative Documentation">
      
      
      
      
        <link rel="canonical" href="https://knative.dev/docs/serving/istio-authorization/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.6">
    
    
      
        <title>Enabling requests to Knative services when additional authorization policies are enabled - Knative Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#before-you-begin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Knative Docs" class="md-header__button md-logo" aria-label="Knative Docs" data-md-component="logo">
      
  <img src="../../images/logo/rgb/knative-logo-rgb.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Knative Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Enabling requests to Knative services when additional authorization policies are enabled
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/knative/docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../install/" class="md-tabs__link">
        Installing Knative
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started-knative-app/" class="md-tabs__link md-tabs__link--active">
        Serving Component
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../eventing/samples.md" class="md-tabs__link">
        Eventing Component
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../client/install-kn/" class="md-tabs__link">
        Client
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/api/serving/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../todo" class="md-tabs__link">
      Community
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Knative Docs" class="md-nav__button md-logo" aria-label="Knative Docs" data-md-component="logo">
      
  <img src="../../images/logo/rgb/knative-logo-rgb.png" alt="logo">

    </a>
    Knative Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/knative/docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Installing Knative
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Installing Knative" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installing Knative
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../install/any-kubernetes-cluster/" class="md-nav__link">
        Installing using YAML
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../install/knative-with-operators/" class="md-nav__link">
        Installing with the Operator
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../install/knative-offerings/" class="md-nav__link">
        Using a Knative-based Offering
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Serving Component
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Serving Component" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Serving Component
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started-knative-app/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Knative Services
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Knative Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Knative Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../services/creating-services/" class="md-nav__link">
        Creating Knative Services
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../services/deployment/" class="md-nav__link">
        Configuring the Knative Deployment
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../knative-kubernetes-services/" class="md-nav__link">
        Knative Kubernetes Components
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../deploying/private-registry/" class="md-nav__link">
        Using a Private Registry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../accessing-traces/" class="md-nav__link">
        Accessing Request Traces
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-local-route/" class="md-nav__link">
        Configuing Cluster-Local Services
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../using-subroutes/" class="md-nav__link">
        Creating and Using Sub-Routes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rolling-out-latest-revision/" class="md-nav__link">
        Gradually Rolling out Revisions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debugging-application-issues/" class="md-nav__link">
        Debugging Issues with your Application
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tag-resolution/" class="md-nav__link">
        Enabling tag to digest resolution
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../config-ha/" class="md-nav__link">
        Configuring high-availability components
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../feature-flags/" class="md-nav__link">
        Feature Flags
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../using-a-tls-cert/" class="md-nav__link">
        Configuring HTTPS Connections
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_14" type="checkbox" id="__nav_3_14" >
      
      <label class="md-nav__link" for="__nav_3_14">
        Setting up Cert-Manager
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Setting up Cert-Manager" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_14">
          <span class="md-nav__icon md-icon"></span>
          Setting up Cert-Manager
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../installing-cert-manager/" class="md-nav__link">
        Installing cert-manager for TLS Certificates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../using-cert-manager-on-gcp/" class="md-nav__link">
        Configuring HTTPS with cert-manager and Google Cloud DNS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../using-auto-tls/" class="md-nav__link">
        Enabling automatic TLS certificate provisioning
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../webhook-customizations/" class="md-nav__link">
        Exclude namespaces from the Knative webhook
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_16" type="checkbox" id="__nav_3_16" >
      
      <label class="md-nav__link" for="__nav_3_16">
        GKE-Specific Customization
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="GKE-Specific Customization" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_16">
          <span class="md-nav__icon md-icon"></span>
          GKE-Specific Customization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gke-assigning-static-ip-address/" class="md-nav__link">
        Assigning Static IPs in GKE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../using-external-dns-on-gcp/" class="md-nav__link">
        Using ExternalDNS on Google Cloud Platform to automate DNS setup
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_17" type="checkbox" id="__nav_3_17" >
      
      <label class="md-nav__link" for="__nav_3_17">
        Custom Domains
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Custom Domains" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_17">
          <span class="md-nav__icon md-icon"></span>
          Custom Domains
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../using-a-custom-domain/" class="md-nav__link">
        Setting up a Custom Domain
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../using-a-custom-domain-per-service/" class="md-nav__link">
        Setting up a Custom Domain per Service
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../creating-domain-mappings/" class="md-nav__link">
        Creating Domain Mappings
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_18" type="checkbox" id="__nav_3_18" >
      
      <label class="md-nav__link" for="__nav_3_18">
        Using Knative Load Balancing
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Using Knative Load Balancing" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_18">
          <span class="md-nav__icon md-icon"></span>
          Using Knative Load Balancing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../load-balancing/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../load-balancing/target-burst-capacity/" class="md-nav__link">
        Target Burst Capacity
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_19" type="checkbox" id="__nav_3_19" checked>
      
      <label class="md-nav__link" for="__nav_3_19">
        Istio-Specific Configuration
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Istio-Specific Configuration" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_19">
          <span class="md-nav__icon md-icon"></span>
          Istio-Specific Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../setting-up-custom-ingress-gateway/" class="md-nav__link">
        Setting up custom ingress gateway
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Enabling requests to Knative services when additional authorization policies are enabled
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Enabling requests to Knative services when additional authorization policies are enabled
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" class="md-nav__link">
    Before you begin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutual-tls-in-knative" class="md-nav__link">
    Mutual TLS in Knative
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health-checking-and-metrics-collection" class="md-nav__link">
    Health checking and metrics collection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#allowing-access-from-system-pods-by-paths" class="md-nav__link">
    Allowing access from system pods by paths
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_20" type="checkbox" id="__nav_3_20" >
      
      <label class="md-nav__link" for="__nav_3_20">
        Autoscaling
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Autoscaling" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_20">
          <span class="md-nav__icon md-icon"></span>
          Autoscaling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/autoscaling-concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/autoscaling-metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/autoscaling-targets/" class="md-nav__link">
        Targets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/scale-to-zero/" class="md-nav__link">
        Configuring Scale-to-zero
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/concurrency/" class="md-nav__link">
        Configuring Concurrency
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/scale-bounds/" class="md-nav__link">
        Configuring Scale Bounds
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/rps-target/" class="md-nav__link">
        Configuring RPS Target
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/kpa-specific/" class="md-nav__link">
        KPA-Specific Configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling/autoscale-go/" class="md-nav__link">
        Autoscaling Sample App
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_21" type="checkbox" id="__nav_3_21" >
      
      <label class="md-nav__link" for="__nav_3_21">
        Samples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Samples" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_21">
          <span class="md-nav__icon md-icon"></span>
          Samples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../samples/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_21_2" type="checkbox" id="__nav_3_21_2" >
      
      <label class="md-nav__link" for="__nav_3_21_2">
        Hello World
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Hello World" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_21_2">
          <span class="md-nav__icon md-icon"></span>
          Hello World
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../samples/hello-world/helloworld-go/" class="md-nav__link">
        Hello World Go
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../samples/rest-api-go/" class="md-nav__link">
        Rest API
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_21_4" type="checkbox" id="__nav_3_21_4" >
      
      <label class="md-nav__link" for="__nav_3_21_4">
        Cloud Events
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Cloud Events" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_21_4">
          <span class="md-nav__icon md-icon"></span>
          Cloud Events
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../samples/cloudevents/cloudevents-nodejs/" class="md-nav__link">
        NodeJS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../samples/cloudevents/cloudevents-vertx/" class="md-nav__link">
        Java (Vert.x)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../samples/cloudevents/cloudevents-rust/" class="md-nav__link">
        Rust
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../samples/blue-green-deployment/" class="md-nav__link">
        Blue Green Deployment
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Eventing Component
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Eventing Component" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Eventing Component
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../eventing/samples.md" class="md-nav__link">
        Samples
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Client
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Client" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../client/install-kn/" class="md-nav__link">
        Installing the Client
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../client/_index/" class="md-nav__link">
        Using the Client
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/serving/" class="md-nav__link">
        Serving
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/eventing/eventing/" class="md-nav__link">
        Eventing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../todo" class="md-nav__link">
        Community
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/knative/docs/edit/main/docs/serving/istio-authorization.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Enabling requests to Knative services when additional authorization policies are enabled</h1>
                
                <p>Knative Serving system pods, such as the activator and autoscaler components, require access to your deployed Knative services.
If you have configured additional security features, such as Istio's authorization policy, you must enable access to your Knative service for these system pods.</p>
<h2 id="before-you-begin">Before you begin<a class="headerlink" href="#before-you-begin" title="Permanent link">&para;</a></h2>
<p>You must meet the following prerequisites to use Istio AuthorizationPolicy:</p>
<ul>
<li><a href="https://knative.dev/docs/install/any-kubernetes-cluster/#installing-the-serving-component">Istio must be used for your Knative Ingress</a>.</li>
<li><a href="https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/">Istio sidecar injection must be enabled</a>.</li>
</ul>
<h2 id="mutual-tls-in-knative">Mutual TLS in Knative<a class="headerlink" href="#mutual-tls-in-knative" title="Permanent link">&para;</a></h2>
<p>Because Knative requests are frequently routed through activator, some considerations need to be made when using mutual TLS.</p>
<p><img alt="Knative request flow" src="../images/architecture.png" /></p>
<p>Generally, mutual TLS can be configured normally as <a href="https://istio.io/latest/docs/tasks/security/authentication/mtls-migration/">in Istio's documentation</a>. However, since the activator can be in the request path of Knative services, it must have sidecars injected. The simplest way to do this is to label the <code>knative-serving</code> namespace:</p>
<div class="highlight"><pre><span></span><code>kubectl label namespace knative-serving istio-injection=enabled
</code></pre></div>
<p>If the activator isn't injected:</p>
<ul>
<li>In PERMISSIVE mode, you'll see requests appear without the expected <code>X-Forwarded-Client-Cert</code> header when forwarded by the activator.</li>
</ul>
<div class="highlight"><pre><span></span><code>$ kubectl exec deployment/httpbin -c httpbin -it -- curl -s http://httpbin.knative.svc.cluster.local/headers
{
  &quot;headers&quot;: {
    &quot;Accept&quot;: &quot;*/*&quot;,
    &quot;Accept-Encoding&quot;: &quot;gzip&quot;,
    &quot;Forwarded&quot;: &quot;for=10.72.0.30;proto=http&quot;,
    &quot;Host&quot;: &quot;httpbin.knative.svc.cluster.local&quot;,
    &quot;K-Proxy-Request&quot;: &quot;activator&quot;,
    &quot;User-Agent&quot;: &quot;curl/7.58.0&quot;,
    &quot;X-B3-Parentspanid&quot;: &quot;b240bdb1c29ae638&quot;,
    &quot;X-B3-Sampled&quot;: &quot;0&quot;,
    &quot;X-B3-Spanid&quot;: &quot;416960c27be6d484&quot;,
    &quot;X-B3-Traceid&quot;: &quot;750362ce9d878281b240bdb1c29ae638&quot;,
    &quot;X-Envoy-Attempt-Count&quot;: &quot;1&quot;,
    &quot;X-Envoy-Internal&quot;: &quot;true&quot;
  }
}
</code></pre></div>
<ul>
<li>In STRICT mode, requests will simply be rejected.</li>
</ul>
<p>To understand when requests are forwarded through the activator, see <a href="https://knative.dev/docs/serving/autoscaling/target-burst-capacity/">documentation</a> on the <code>TargetBurstCapacity</code> setting.</p>
<p>This also means that many Istio AuthorizationPolicies won't work as expected. For example, if you set up a rule allowing requests from a particular source into a Knative service, you will see requests being rejected if they are forwarded by the activator.</p>
<p>For example, the following policy allows requests from within pods in the <code>serving-tests</code> namespace to other pods in the <code>serving-tests</code> namespace.</p>
<div class="highlight"><pre><span></span><code>apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
 name: allow-serving-tests
 namespace: serving-tests
spec:
 action: ALLOW
 rules:
 - from:
   - source:
      namespaces: [&quot;serving-tests&quot;]
</code></pre></div>
<p>Requests here will fail when forwarded by the activator, because the Istio proxy at the destination service will see the source namespace of the requests as <code>knative-serving</code>, which is the namespace of the activator.</p>
<p>Currently, the easiest way around this is to explicitly allow requests from the <code>knative-serving</code> namespace, for example by adding it to the list in the above policy:</p>
<div class="highlight"><pre><span></span><code>apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
 name: allow-serving-tests
 namespace: serving-tests
spec:
 action: ALLOW
 rules:
 - from:
   - source:
      namespaces: [&quot;serving-tests&quot;, &quot;knative-serving&quot;]
</code></pre></div>
<h2 id="health-checking-and-metrics-collection">Health checking and metrics collection<a class="headerlink" href="#health-checking-and-metrics-collection" title="Permanent link">&para;</a></h2>
<p>In addition to allowing your application path, you'll need to configure Istio AuthorizationPolicy
to allow health checking and metrics collection to your applications from system pods.
You can allow access from system pods <a href="#allow-access-from-system-pods-by-paths">by paths</a>.</p>
<h2 id="allowing-access-from-system-pods-by-paths">Allowing access from system pods by paths<a class="headerlink" href="#allowing-access-from-system-pods-by-paths" title="Permanent link">&para;</a></h2>
<p>Knative system pods access your application using the following paths:</p>
<ul>
<li><code>/metrics</code></li>
<li><code>/healthz</code></li>
</ul>
<p>The <code>/metrics</code> path allows the autoscaler pod to collect metrics.
The <code>/healthz</code> path allows system pods to probe the service.</p>
<p>You can add the <code>/metrics</code> and <code>/healthz</code> paths to the AuthorizationPolicy as shown in the example:</p>
<div class="highlight"><pre><span></span><code>$ cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allowlist-by-paths
  namespace: serving-tests
spec:
  action: ALLOW
  rules:
  - to:
    - operation:
        paths:
        - /metrics   # The path to collect metrics by system pod.
        - /healthz   # The path to probe by system pod.
EOF
</code></pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../setting-up-custom-ingress-gateway/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Setting up custom ingress gateway
            </div>
          </div>
        </a>
      
      
        <a href="../autoscaling/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Overview
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
    
  </body>
</html>